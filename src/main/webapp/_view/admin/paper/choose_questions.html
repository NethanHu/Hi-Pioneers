<!-- 主界面 -->
<div class="main">
<!-- 主体内容 -->
<form id="search" action="/admin/paper/search" onsubmit="return searchQuestions()">
    <div class="toolbar">
        <label>选择题目的条件：</label>
        <select id="question_course">
            <option value="">----|选择科目|--</option>
        </select>

        <select id="question_type">
            <option value="">----|选择类型|--</option>
        </select>

        <select id="question_level">
            <option value="">----|选择难度|--</option>
        </select>

        <button class="btn btn-success btn-sm">
            <i class="fa fa-filter"></i> 检索题库
        </button>
    </div>
    <div id="table-box" class="table-box">


        <table class="table table-hover">

            <thead>
            <tr>
                <th>ID</th>
                <th>问题</th>
                <th>科目</th>
                <th>类型</th>
                <th>难度</th>
                <th class="operation">操作</th>
            </tr>

            </thead>

            <tbody>
            #for (x : page.getList())

<!--            TO DO: 把过长的题目采取 overflow: hidden 的策略-->
<!--            目前尚未完成，行内 CSS 样式没有效果-->
            <tr>
                <td>#(x.id)</td>
                <td style="height: 21px; text-overflow: ellipsis" id="question_#(x.id)">#(x.question)</td>
                <td>#(x.course_name)</td>
                <td>#(x.type)</td>
                <td>#(x.level)</td>
                <td class="operation">
                    <button type="checkbox" id="btn_#(x.id)" onclick="choose('#(x.id)')">选择</button>
                </td>
            </tr>
            #end
            </tbody>

        </table>
    </div>
    ### 将 keyword 放入 append，促使分页链接中追加该参数用于搜索
    #set(append = keyword ? '&keyword=' + keyword : '')
    #@adminPaginate(page, "/admin/paper/search?pn=")
</form>
</div>

<!-- 弹出层 button -->
<div class="layui-layer-btn" style="padding: 10px 25px 20px 0;">

</div>
<div id="create_paper" class="panel">
    <!-- 加载动画 -->
    <i class="fa fa-spinner fa-pulse fa-2x" style="padding:20px;"></i>
</div>

<script src="/assets/js/paper-kit.js"></script>


<!-- 弹出层 js 脚本 -->
<script>
    $(function() {
        // 在页面加载的时候就自己填充 <select> 中的 <option> 元素
        fillAllSelectOptions();

        kit.fill('/admin/paper/createPaper', null, '#create_paper');
    });

    var question_course_select = document.getElementById('question_course');
    var question_type_select = document.getElementById('question_type');
    var question_level_select = document.getElementById('question_level');

    function fillAllSelectOptions() {
        // 填充分类选项
        fillSelectOptions(question_course, question_course_select);
        fillSelectOptions(question_type, question_type_select);
        fillSelectOptions(question_level, question_level_select);
    }

    function searchQuestions() {
        // TO DO: 在这里完成检索题库的方法
        let url = $('#search').attr('action');

        let course = $('#question_course option:selected').val();
        let type = $('#question_type option:selected').val();
        let level = $('#question_level option:selected').val();

        kit.loading({msg:'正在搜索, 请稍候 .....'});
        $.ajax({url: url, data: {course : course, type : type, level : level},
            type: 'POST', cache: false, dataType: 'html',
            success: function(ret) {
                kit.closeLoading();

                // 如果返回 json 格式数据，则 msg 输出，例如后端验证参数失败会返回 json
                if (kit.isJsonRet(ret)) {
                    kit.msg(kit.strToJson(ret), {time:3900, closeBtn:2});
                } else {
                    $('#content-box').html(ret);
                    $('#search-keyword').select();
                }
            }
        });
        // 返回 false 避免表单提交，请求已经使用上面的 $.ajax 发送完成
        return false;
    }

    function choose(btn_id){
        let btn = document.getElementById("btn_"+btn_id);
        btn.setAttribute("disabled", "disabled");
        let question_content = document.getElementById("question_" + btn_id).innerHTML;
        let question_obj = new AddedQuestion(btn_id, question_content)
        console.log(question_obj);
    }
</script>