<!-- 弹出层 title -->
<div class="layui-layer-title" style="cursor: move;">
    手动组卷
</div>

<!-- 弹出层主体内容 -->
<form id="search" action="/admin/paper/search" onsubmit="return searchQuestions()">
    <div class="open-box" style="padding: 30px 30px 15px 30px;">
    <select id="question_course">

    </select>

    <select id="question_type">

    </select>

    <select id="question_level">

    </select>

    <button class="btn btn-success btn-sm" >
        <i class="fa fa-filter"></i> 检索题库
    </button>
    </div>
    <div id="table-box" class="table-box">


        <table class="table table-hover">

            <thead>
            <tr>
                <th>ID</th>
                <th>问题</th>
                <th >type</th>
                <th>创建时间</th>
                <th class="operation">操作</th>
            </tr>

            </thead>

            <tbody>
            #for (x : page.getList())

            <tr>
                <td>#(x.id)</td>
                <td>#(x.question)</td>
                <td>#(x.type)</td>
                <td>#date(x.update_time)</td>

            </tr>
            #end
            </tbody>

        </table>
    </div>
    ### 将 keyword 放入 append，促使分页链接中追加该参数用于搜索
    #set(append = keyword ? '&keyword=' + keyword : '')
    #@adminPaginate(page, "/admin/paper/search?pn=")
</form>

<!-- 弹出层 button -->
<div class="layui-layer-btn" style="padding: 10px 25px 20px 0;">

</div>

<script src="/assets/js/paper-kit.js"></script>
<!-- 弹出层 js 脚本 -->
<script>
    $(function() {
        // 在页面加载的时候就自己填充 <select> 中的 <option> 元素
        fillAllSelectOptions();
    });

    var question_course_select = document.getElementById('question_course');
    var question_type_select = document.getElementById('question_type');
    var question_level_select = document.getElementById('question_level');

    function fillAllSelectOptions() {
        // 填充分类选项
        fillSelectOptions(question_course, question_course_select);
        fillSelectOptions(question_type, question_type_select);
        fillSelectOptions(question_level, question_level_select);
    }

    function searchQuestions() {
        // TO DO: 在这里完成检索题库的方法
        var url = $('#search').attr('action');

        var course = $('#question_course option:selected').val();
        var type = $('#question_type option:selected').val();
        var level = $('#question_level option:selected').val();

        kit.loading({msg:'正在搜索, 请稍候 .....'});
        $.ajax({url: url, data: {course : course, type : type, level : level},
            type: 'POST', cache: false, dataType: 'html',
            success: function(ret) {
                kit.closeLoading();

                // 如果返回 json 格式数据，则 msg 输出，例如后端验证参数失败会返回 json
                if (kit.isJsonRet(ret)) {
                    kit.msg(kit.strToJson(ret), {time:3900, closeBtn:2});
                } else {
                    $('#content-box').html(ret);
                    $('#search-keyword').select();
                }
            }
        });
        // 返回 false 避免表单提交，请求已经使用上面的 $.ajax 发送完成
        return false;
    }

</script>